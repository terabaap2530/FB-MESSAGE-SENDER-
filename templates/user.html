<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Panel</title>
<link rel="stylesheet" href="/static/style.css">
<style>
body {
    font-family: 'Montserrat', sans-serif;
    margin: 0;
    background: url('/static/bg.jpg') center/cover fixed;
    color: #fff;
}
.header, .footer {
    background: rgba(0,0,0,0.6);
    padding: 15px;
    text-align: center;
    font-weight: bold;
    color: #ffcc00;
    position: sticky;
    top: 0;
    z-index: 100;
}
.container {
    max-width: 900px;
    margin: 20px auto;
    background: rgba(0,0,0,0.7);
    border-radius: 12px;
    padding: 20px;
    overflow-y: auto;
    max-height: 75vh;
}
.button {
    padding: 8px 12px;
    margin: 3px;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    color: black;
    background-color: #ffcc00;
}
.task-card {
    border: 1px solid #ffcc00;
    margin: 10px 0;
    padding: 15px;
    border-radius: 10px;
    background: rgba(255,255,0,0.05);
}
.task-card b { color: #ffcc00; }
</style>
</head>
<body>

<div class="header">
    User Panel - {{ username }}
    <a href="/admin" class="button">Admin Panel</a>
</div>

<div class="container">
    <h2>My Tasks</h2>
    <div id="tasks"></div>
</div>

<div class="footer">Â© 2024 D3V3L0P3D BY AXSHU | 
    <a href="https://www.facebook.com/profile.php?id=61574791744025" target="_blank">FACEBOOK</div>

<script>
const username = "{{ username }}";

// Load tasks for this user only
async function loadTasks() {
    const resp = await fetch(`/user/data/${username}`);
    const data = await resp.json();
    const container = document.getElementById('tasks');
    container.innerHTML = '';
    
    if(!data.tasks || Object.keys(data.tasks).length === 0){
        container.innerHTML = "<p>No tasks started yet.</p>";
        return;
    }
    
    for(let id in data.tasks){
        const t = data.tasks[id];
        const card = document.createElement('div');
        card.className = 'task-card';
        card.innerHTML = `
            <b>Task ID:</b> ${t.task_id}<br>
            <b>Status:</b> ${t.status} (${t.last_status})<br>
            <b>Messages Sent:</b> ${t.messages_sent}<br>
            <b>Details:</b> ${t.details}<br>
            <button onclick="action('${id}','pause')">Pause</button>
            <button onclick="action('${id}','resume')">Resume</button>
            <button onclick="action('${id}','stop')">Stop</button>
        `;
        container.appendChild(card);
    }
}

// Send action to backend
async function action(task_id, act){
    await fetch(`/user/action/${username}/${task_id}/${act}`, {method: 'POST'});
    loadTasks();
}

// Refresh tasks every 2 seconds
setInterval(loadTasks, 2000);
loadTasks();
</script>

</body>
</html>
